(function(){var e=0;var t=["ms","moz","webkit","o"];for(var n=0;n<t.length&&!window.requestAnimationFrame;++n){window.requestAnimationFrame=window[t[n]+"RequestAnimationFrame"];window.cancelAnimationFrame=window[t[n]+"CancelAnimationFrame"]||window[t[n]+"CancelRequestAnimationFrame"]}if(!window.requestAnimationFrame)window.requestAnimationFrame=function(t,n){var r=(new Date).getTime();var i=Math.max(0,16-(r-e));var s=window.setTimeout(function(){t(r+i)},i);e=r+i;return s};if(!window.cancelAnimationFrame)window.cancelAnimationFrame=function(e){clearTimeout(e)}})();var Nodes={density:20,drawDistance:21,baseRadius:5,maxLineThickness:5,reactionSensitivity:3,lineThickness:3,points:[],mouse:{x:-1e3,y:-1e3,down:false},animation:null,canvas:null,context:null,bgImage:null,bgCanvas:null,bgContext:null,bgContextPixelData:null,init:function(){this.canvas=document.getElementById("canvas");this.context=canvas.getContext("2d");this.context.globalCompositeOperation="lighter";this.canvas.width=window.innerWidth;this.canvas.height=window.innerHeight;this.canvas.style.display="block";this.canvas.addEventListener("mousemove",this.mouseMove,false);this.canvas.addEventListener("mousedown",this.mouseDown,false);this.canvas.addEventListener("mouseup",this.mouseUp,false);this.canvas.addEventListener("mouseout",this.mouseOut,false);window.onresize=function(e){Nodes.canvas.width=window.innerWidth;Nodes.canvas.height=window.innerHeight;Nodes.onWindowResize()};this.loadData("assets/bg.png")},preparePoints:function(){this.points=[];var e,t,n,r;var i=this.bgContextPixelData.data;for(n=0;n<this.canvas.height;n+=this.density){for(r=0;r<this.canvas.width;r+=this.density){var s=(r+n*this.bgContextPixelData.width)*4;if(i[s]<50&&i[s+1]<50&&i[s+2]<50||i[s+3]===0){continue}var o="rgba("+i[s]+","+i[s+1]+","+i[s+2]+","+"1)";this.points.push({x:r,y:n,originalX:r,originalY:n,color:o})}}},updatePoints:function(){var e,t,n,r;for(e=0;e<this.points.length;e++){t=this.points[e];n=Math.atan2(t.y-this.mouse.y,t.x-this.mouse.x);if(this.mouse.down){r=this.reactionSensitivity*200/Math.sqrt((this.mouse.x-t.x)*(this.mouse.x-t.x)+(this.mouse.y-t.y)*(this.mouse.y-t.y))}else{r=this.reactionSensitivity*100/Math.sqrt((this.mouse.x-t.x)*(this.mouse.x-t.x)+(this.mouse.y-t.y)*(this.mouse.y-t.y))}t.x+=Math.cos(n)*r+(t.originalX-t.x)*.05;t.y+=Math.sin(n)*r+(t.originalY-t.y)*.05}},drawLines:function(){var e,t,n,r,i,s;for(e=0;e<this.points.length;e++){n=this.points[e];this.context.fillStyle=n.color;this.context.strokeStyle=n.color;for(t=0;t<this.points.length;t++){r=this.points[t];if(r==n){continue}i=Math.sqrt((r.x-n.x)*(r.x-n.x)+(r.y-n.y)*(r.y-n.y));if(i<=this.drawDistance){this.context.lineWidth=(1-i/this.drawDistance)*this.maxLineThickness*this.lineThickness;this.context.beginPath();this.context.moveTo(n.x,n.y);this.context.lineTo(r.x,r.y);this.context.stroke()}}}},drawPoints:function(){var e,t;for(e=0;e<this.points.length;e++){t=this.points[e];this.context.fillStyle=t.color;this.context.strokeStyle=t.color;this.context.beginPath();this.context.arc(t.x,t.y,this.baseRadius,0,Math.PI*2,true);this.context.closePath();this.context.fill()}},draw:function(){this.animation=requestAnimationFrame(function(){Nodes.draw()});this.clear();this.updatePoints();this.drawLines();this.drawPoints()},clear:function(){this.canvas.width=this.canvas.width},loadData:function(e){this.bgImage=new Image;this.bgImage.src=e;console.log(this.bgImage.src);this.bgImage.onload=function(){Nodes.drawImageToBackground()}},drawImageToBackground:function(){this.bgCanvas=document.createElement("canvas");this.bgCanvas.width=this.canvas.width;this.bgCanvas.height=this.canvas.height;var e,t;if(this.bgImage.width>this.bgCanvas.width-100||this.bgImage.height>this.bgCanvas.height-100){var n=Math.max(this.bgImage.width/(this.bgCanvas.width-100),this.bgImage.height/(this.bgCanvas.height-100));e=this.bgImage.width/n;t=this.bgImage.height/n}else{e=this.bgImage.width;t=this.bgImage.height}this.bgContext=this.bgCanvas.getContext("2d");this.bgContext.drawImage(this.bgImage,0,80,e,t);this.bgContextPixelData=this.bgContext.getImageData(0,0,this.bgCanvas.width,this.bgCanvas.height);this.preparePoints();this.draw()},mouseDown:function(e){Nodes.mouse.down=true},mouseUp:function(e){Nodes.mouse.down=false},mouseMove:function(e){Nodes.mouse.x=e.offsetX||e.layerX-Nodes.canvas.offsetLeft;Nodes.mouse.y=e.offsetY||e.layerY-Nodes.canvas.offsetTop},mouseOut:function(e){Nodes.mouse.x=-1e3;Nodes.mouse.y=-1e3;Nodes.mouse.down=false},onWindowResize:function(){cancelAnimationFrame(this.animation);this.drawImageToBackground()}};Nodes.init()